USE [Homolog]
GO

IF OBJECT_ID('dbo.__Homolog', 'P') IS NOT NULL
    DROP PROCEDURE [dbo].[__Homolog]
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE __Homolog
AS
	/***************************************************************************************************************************************************************************************
	*	AUTOR....................: ANDERSON LOPEZ
	*	DATA.....................: 29/12/2022	
	*	DESCRI플O................: Procedure Homolog que chama todas as Proc e a excuta conforme seu "agendamento"
	***************************************************************************************************************************************************************************************/
	DECLARE @DATA_ATUAL										DATE = GETDATE();
	/**************************************************************************************************************************************************************************************/
	DECLARE @ERROR_NUMBER_AUX								VARCHAR(500);
	DECLARE @ERROR_SEVERITY_AUX								VARCHAR(500);
	DECLARE @ERROR_STATE_AUX								VARCHAR(500);
	DECLARE @ERROR_PROCEDURE_AUX							VARCHAR(500);
	DECLARE @ERROR_LINE_AUX									VARCHAR(500);
	DECLARE @ERROR_MESSAGE_AUX								VARCHAR(500);
	/**************************************************************************************************************************************************************************************/
	/**************************************************************************************************************************************************************************************/
	/**************************************************************************************************************************************************************************************/
BEGIN 	
	BEGIN TRY
	/***************************************************************************************************************************************************************************************
	*	- PROCEDURE QUE VERIFICA AS EXECU합ES CONLCUIDAS.
	***************************************************************************************************************************************************************************************/	
		EXEC [dbo].[_PROC_PROCESSO_EXECUCAO];
	/***************************************************************************************************************************************************************************************
	*	- PROCEDURE QUE FAZ ENVIO DO RESUMO DE IMPORTA플O DAS CARGAS.
	***************************************************************************************************************************************************************************************/	
		EXEC [dbo].[_PROC_REL_IMP_CARGA];
	/***************************************************************************************************************************************************************************************
	*	- PROCEDURE QUE SE EXISTE ARQUIVOS PARA SER ALTERADOS DA PASTAS ORIGEM PARA A PASTA DESTINO.
	***************************************************************************************************************************************************************************************/	
		EXEC [dbo].[_PROC_MOVE_ARQUIVO];
	/***************************************************************************************************************************************************************************************
	*	- 
	***************************************************************************************************************************************************************************************/
		EXEC [dbo].[_PROC_ACORDO_BAIXA]
	/***************************************************************************************************************************************************************************************
	*	- REALIZA O ENVIO DOS EMAILS APOS AS EXECU합ES DAS PROCEDURES.
	***************************************************************************************************************************************************************************************/		
		EXEC [dbo].[_PROC_ENVIO_EMAIL];
	END TRY 
	BEGIN CATCH  
		SELECT 
			@ERROR_NUMBER_AUX = ISNULL(CONVERT(VARCHAR(500), ERROR_NUMBER()), '')
			,@ERROR_SEVERITY_AUX = ISNULL(CONVERT(VARCHAR(500), ERROR_SEVERITY()), '')
			,@ERROR_STATE_AUX = ISNULL(CONVERT(VARCHAR(500), ERROR_STATE()), '')
			,@ERROR_PROCEDURE_AUX = ISNULL(CONVERT(VARCHAR(500), ERROR_PROCEDURE()), '')
			,@ERROR_LINE_AUX = ISNULL(CONVERT(VARCHAR(500), ERROR_LINE()), '')
			,@ERROR_MESSAGE_AUX = ISNULL(CONVERT(VARCHAR(500), ERROR_MESSAGE()), '');
		
		SELECT @ERROR_NUMBER_AUX, @ERROR_SEVERITY_AUX ,@ERROR_STATE_AUX ,@ERROR_PROCEDURE_AUX ,@ERROR_LINE_AUX ,@ERROR_MESSAGE_AUX 
	
		EXEC [dbo].[__PROC_SQL_ERROR_EMAIL]
			@ERROR_NUMBER = @ERROR_NUMBER_AUX
			,@ERROR_SEVERITY = @ERROR_SEVERITY_AUX
			,@ERROR_STATE = @ERROR_STATE_AUX
			,@ERROR_PROCEDURE = @ERROR_PROCEDURE_AUX
			,@ERROR_LINE = @ERROR_LINE_AUX
			,@ERROR_MESSAGE = @ERROR_MESSAGE_AUX;

		EXEC [dbo].[_PROC_ENVIO_EMAIL];
	END CATCH; 
END;